<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="[MySQL] innoDB"><meta name="keywords" content="CS,DB"><meta name="author" content="Song Hayoung"><meta name="copyright" content="Song Hayoung"><title>[MySQL] innoDB | SUMFIのBlog</title><link rel="shortcut icon" href="/songcon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-169368422-1', 'auto');
ga('send', 'pageview');</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"7LZ6OJ4D6C","apiKey":"9a84e13f74ea78c3fd54512c10139c56","indexName":"git blog","hits":{"per_page":10},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/rss2.xml" title="SUMFIのBlog" type="application/rss+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#InnoDB"><span class="toc-number">1.</span> <span class="toc-text">InnoDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#InnoDB-%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80-%EC%97%94%EC%A7%84-%ED%8A%B9%EC%84%B1"><span class="toc-number">2.</span> <span class="toc-text">InnoDB 스토리지 엔진 특성</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%ED%94%84%EB%9D%BC%EC%9D%B4%EB%A8%B8%EB%A6%AC-%ED%82%A4%EC%97%90-%EC%9D%98%ED%95%9C-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0%EB%A7%81"><span class="toc-number">2.1.</span> <span class="toc-text">프라이머리 키에 의한 클러스터링</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Non-locking-consistent-read"><span class="toc-number">2.2.</span> <span class="toc-text">Non-locking consistent read</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%99%B8%EB%9E%98%ED%82%A4-%EC%A7%80%EC%9B%90"><span class="toc-number">2.3.</span> <span class="toc-text">외래키 지원</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%9E%90%EB%8F%99-%EB%8D%B0%EB%93%9C%EB%9D%BD-%EA%B0%90%EC%A7%80"><span class="toc-number">2.4.</span> <span class="toc-text">자동 데드락 감지</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#InnoDB-%EB%B2%84%ED%8D%BC-%ED%92%80"><span class="toc-number">3.</span> <span class="toc-text">InnoDB 버퍼 풀</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Undo-%EB%A1%9C%EA%B7%B8"><span class="toc-number">4.</span> <span class="toc-text">Undo 로그</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Insert-Buffer"><span class="toc-number">5.</span> <span class="toc-text">Insert Buffer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redo-%EB%A1%9C%EA%B7%B8"><span class="toc-number">6.</span> <span class="toc-text">Redo 로그</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MVCC-Multi-Version-Concurrency-Control"><span class="toc-number">7.</span> <span class="toc-text">MVCC - Multi Version Concurrency Control</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://avatars3.githubusercontent.com/u/37806785?s=460&amp;u=8c68d685faf7c5280cfbd736a6b1730b55fb4203&amp;v=4"></div><div class="author-info__name text-center">Song Hayoung</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://www.instagram.com/hayoung0_0/">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">8253</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">193</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">60</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">VISITED</div><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">Seoul Korea</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">Jeju Korea</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">British Columbia Canada</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">Boracay Philippines</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">三重　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">大阪　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">名古屋　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">静岡　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">札幌　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">京都　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">Bangkok Thailand</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://xxxx.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">SUMFIのBlog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/about">About</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">[MySQL] innoDB</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-09-02</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Computer-Science/">Computer Science</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Computer-Science/DB/">DB</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">397</span><span class="post-meta__separator">|</span><span>Reading time: 2 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h2><span id="more"></span>
<h2 id="InnoDB-스토리지-엔진-특성"><a href="#InnoDB-스토리지-엔진-특성" class="headerlink" title="InnoDB 스토리지 엔진 특성"></a>InnoDB 스토리지 엔진 특성</h2><h3 id="프라이머리-키에-의한-클러스터링"><a href="#프라이머리-키에-의한-클러스터링" class="headerlink" title="프라이머리 키에 의한 클러스터링"></a>프라이머리 키에 의한 클러스터링</h3><p>InnoDB는 기본적으로 프라이머리키를 기준으로 클러스터링 되어 저장된다. 그렇기 때문에 프라이머리 키에 의한 레인지 스캔은 빠르게 커리될 수 있으며 쿼리 실행 계획에서 프라이머리 키는 다른 보조 인덱스에 비해 비중이 높게 설정된다. 즉, 프라이머리 키를 선택해 쿼리를 실행할 확률이 높아진다.</p>
<h3 id="Non-locking-consistent-read"><a href="#Non-locking-consistent-read" class="headerlink" title="Non-locking consistent read"></a>Non-locking consistent read</h3><p>InnoDB에서 순수한 읽기 작업은 <strong>MVCC(Multi Version Concurrency Control)</strong>을 통해 락을 걸지 않고 읽기 작업을 수행한다. 락을 걸지 않기 때문에 다른 트랜잭션이 가지고 있는 락을 기다리지도 않는다. 단, SERIALIZABLE 격리 수준 제외한다.</p>
<h3 id="외래키-지원"><a href="#외래키-지원" class="headerlink" title="외래키 지원"></a>외래키 지원</h3><p>외래키는 InnoDB 스토리지 엔진 레벨에서 지원을 한다. 하지만 외래키를 잘못 사용하게 되면 데드락의 위험이 있다. 가령 외래키는 부모 테이블과 자식 테이블 모두 해당 칼럼에 인덱스 생성이 필요하고, 변경시에는 부모와 자식 테이블 모두 해당 데이터가 있는지 확인하는 작업이 필요하므로 잠금이 여러 테이블에 전파되어 데드락이 발생하게 된다.</p>
<h3 id="자동-데드락-감지"><a href="#자동-데드락-감지" class="headerlink" title="자동 데드락 감지"></a>자동 데드락 감지</h3><p>InnoDB는 그래프 기반의 데드락 체크 방식을 사용하여 데드락을 감지한다. 감지된 데드락은 관련 트랜잭션중 ROLLBACK이 가장 용이한 트랜잭션을 선택해 종료시킨다.</p>
<h2 id="InnoDB-버퍼-풀"><a href="#InnoDB-버퍼-풀" class="headerlink" title="InnoDB 버퍼 풀"></a>InnoDB 버퍼 풀</h2><p>INSERT, UPDATE, DELETE같이 데이터를 변경시키는 쿼리는 데이터 파일의 다양한 영역에 접근해 레코드를 변경하기 때문에 랜덤 디스크 IO를 유발시킨다. InnoDB는 버퍼풀을 사용하여 변경된 데이터를 모아 한꺼번에 처리할 수 있다. 그 외에도 버퍼 풀에는 인덱스를 캐시해둘 수 있는데 <strong>인덱스의 크기가 크다면</strong> 그만큼 캐시해둘 수 있는 레코드의 크기가 줄어든다. 그렇기 때문에 적절한 인덱스 컬럼의 선택도 중요하다.</p>
<h2 id="Undo-로그"><a href="#Undo-로그" class="headerlink" title="Undo 로그"></a>Undo 로그</h2><p>Undo 로그는 UPDATE, DELETE로 데이터를 변경했을 때 변경되기 전의 데이터를 보관하는 영역이다. 이 영역은 <strong>트랜잭션의 롤백 대비용</strong>이나 <strong>트랜잭션 격리 수준을 유지하면서 높은 동시성을 제공</strong>하는데 사용된다.</p>
<h2 id="Insert-Buffer"><a href="#Insert-Buffer" class="headerlink" title="Insert Buffer"></a>Insert Buffer</h2><p>레코드가 INSERT나 UPDATE될 때는 테이블에 포함된 인덱스를 업데이트하는 작업이 필요하다. 이 작업 또한 랜덤 디스크 IO를 유발하므로 이를 방지하기 위해 사용한다. InnoDB 버퍼 풀에 변경해야할 인덱스 페이지가 있다면 바로 변경하지만, 디스크에서 읽어와 변경해야 한다면 Insert Buffer에 저장해두고 사용자에게는 결과를 반환한다.</p>
<h2 id="Redo-로그"><a href="#Redo-로그" class="headerlink" title="Redo 로그"></a>Redo 로그</h2><p>쿼리를 수행하고 커밋을 진행하면 ACID를 보장하기 위해 데이터를 파일로 기록해야 하는데, 이런 작업은 랜덤 디스크 IO를 유발하게 된다. 이 부하를 줄이기 위해 버퍼 풀과 같은 장치를 마련했으나 ACID를 완벽히 보장할 수는 없다. 그렇기에 변경된 내용을 순차적으로 기록하는 로그 파일을 지니고 있으며 이 로그 파일이 Redo 로그이다.</p>
<h2 id="MVCC-Multi-Version-Concurrency-Control"><a href="#MVCC-Multi-Version-Concurrency-Control" class="headerlink" title="MVCC - Multi Version Concurrency Control"></a>MVCC - Multi Version Concurrency Control</h2><p>MVCC의 가장 큰 목적은 잠금을 사용하지 않는 일관된 읽기 방법을 제공하는 것이다. UPDATE 쿼리를 수행하고 커밋하지 않은 상태에서 해당 레코드를 조회한다고 예를 든다면 반환되는 데이터는 격리 수준에 따라 달라진다.</p>
<p>READ_UNCOMMITED라면 버퍼 풀에서 데이터를 읽어오게 된다. 하지만 그 이상의 격리 수준이라면 언두 영역에 데이터를 반환하게 되는데, 하나의 레코드에 대한 다양한 버전을 관리하기 때문에 MVCC다.</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Song Hayoung</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://songhayoung.github.io/2020/09/02/Database/innoDB/">https://songhayoung.github.io/2020/09/02/Database/innoDB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CS/">CS</a><a class="post-meta__tags" href="/tags/DB/">DB</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/09/02/PS/BOJ/14003/"><i class="fa fa-chevron-left">  </i><span>[BOJ] 14003 가장 긴 증가하는 부분 수열 5</span></a></div><div class="next-post pull-right"><a href="/2020/09/01/Languages/Java/garbeCollector/"><span>[Java] Garbe Collector</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '3604b61642355579f55e',
  clientSecret: 'f552120f18ac5aee3f6297e05e97d94c0a25cd4b',
  repo: 'SongHayoung.github.io',
  owner: 'SongHayoung',
  admin: 'SongHayoung',
  id: md5(decodeURI(location.pathname)),
  language: 'en'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(https://xxxx.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2023 By Song Hayoung</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">Learning how to walk slowly to not miss important things</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/algolia.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>