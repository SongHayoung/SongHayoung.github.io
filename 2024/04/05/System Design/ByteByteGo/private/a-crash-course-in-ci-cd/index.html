<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="[ByteByteGo] A Crash Course in CI/CD"><meta name="keywords" content="System Design"><meta name="author" content="Song Hayoung"><meta name="copyright" content="Song Hayoung"><title>[ByteByteGo] A Crash Course in CI/CD | SUMFIのBlog</title><meta name="robots" content="noindex"><link rel="shortcut icon" href="/songcon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-169368422-1', 'auto');
ga('send', 'pageview');</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"7LZ6OJ4D6C","apiKey":"9a84e13f74ea78c3fd54512c10139c56","indexName":"git blog","hits":{"per_page":10},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/rss2.xml" title="SUMFIのBlog" type="application/rss+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#A-Crash-Course-in-CI-CD"><span class="toc-number">1.</span> <span class="toc-text">A Crash Course in CI&#x2F;CD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Continuous-Integration-CI"><span class="toc-number">2.</span> <span class="toc-text">Continuous Integration (CI)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Avoid-%E2%80%9Cmerge-hell%E2%80%9D"><span class="toc-number">2.1.</span> <span class="toc-text">Avoid “merge hell”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Automation"><span class="toc-number">2.2.</span> <span class="toc-text">Automation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Definition"><span class="toc-number">2.3.</span> <span class="toc-text">Definition</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tools"><span class="toc-number">2.4.</span> <span class="toc-text">Tools</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Benefits-of-continuous-integration"><span class="toc-number">2.5.</span> <span class="toc-text">Benefits of continuous integration</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Continuous-Deployment-CD"><span class="toc-number">3.</span> <span class="toc-text">Continuous Deployment (CD)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Continuous-delivery"><span class="toc-number">3.1.</span> <span class="toc-text">Continuous delivery</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Automatic-deployment"><span class="toc-number">3.2.</span> <span class="toc-text">Automatic deployment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Continuous-deployment-vs-continuous-delivery"><span class="toc-number">3.3.</span> <span class="toc-text">Continuous deployment vs. continuous delivery</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tools-1"><span class="toc-number">3.4.</span> <span class="toc-text">Tools</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Benefits-of-continuous-deployment"><span class="toc-number">3.5.</span> <span class="toc-text">Benefits of continuous deployment</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Deployment-Strategies"><span class="toc-number">4.</span> <span class="toc-text">Deployment Strategies</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Big-bang-deployment"><span class="toc-number">4.1.</span> <span class="toc-text">Big bang deployment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rolling-deployment"><span class="toc-number">4.2.</span> <span class="toc-text">Rolling deployment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Blue-Green-deployment"><span class="toc-number">4.3.</span> <span class="toc-text">Blue-Green deployment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Canary-deployment"><span class="toc-number">4.4.</span> <span class="toc-text">Canary deployment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Feature-toggle"><span class="toc-number">4.5.</span> <span class="toc-text">Feature toggle</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#A-Typical-CI-CD-Pipeline"><span class="toc-number">5.</span> <span class="toc-text">A Typical CI&#x2F;CD Pipeline</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Source"><span class="toc-number">5.1.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Build"><span class="toc-number">5.2.</span> <span class="toc-text">Build</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Code-coverage"><span class="toc-number">5.2.1.</span> <span class="toc-text">Code coverage</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Test-environment"><span class="toc-number">5.3.</span> <span class="toc-text">Test environment</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Toggle-switch"><span class="toc-number">5.3.1.</span> <span class="toc-text">Toggle switch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Consider-dependencies"><span class="toc-number">5.3.2.</span> <span class="toc-text">Consider dependencies</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-box-environment"><span class="toc-number">5.4.</span> <span class="toc-text">1-box environment</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Rollback-alarms"><span class="toc-number">5.4.1.</span> <span class="toc-text">Rollback alarms</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bake-period"><span class="toc-number">5.4.2.</span> <span class="toc-text">Bake period</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Production-environment"><span class="toc-number">5.5.</span> <span class="toc-text">Production environment</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://avatars3.githubusercontent.com/u/37806785?s=460&amp;u=8c68d685faf7c5280cfbd736a6b1730b55fb4203&amp;v=4"></div><div class="author-info__name text-center">Song Hayoung</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/hayoung-song-9523b61bb/">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">11304</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">196</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">62</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">VISITED</div><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">Seoul Korea</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">Jeju Korea</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">British Columbia Canada</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">Boracay Philippines</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">三重　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">大阪　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">名古屋　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">静岡　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">札幌　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">京都　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">Bangkok Thailand</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://xxxx.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">SUMFIのBlog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/about">About</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">[ByteByteGo] A Crash Course in CI/CD</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2024-04-05</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/System-Design/">System Design</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/System-Design/Byte-Byte-Go/">Byte Byte Go</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">2.3k</span><span class="post-meta__separator">|</span><span>Reading time: 14 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="A-Crash-Course-in-CI-CD"><a href="#A-Crash-Course-in-CI-CD" class="headerlink" title="A Crash Course in CI/CD"></a>A Crash Course in CI/CD</h2><span id="more"></span>
<p>CI/CD는 초기 코드 커밋부터 배포까지 소프트웨어 개발 프로세스를 자동화하는 데 도움이 된다. 기존에 코드를 프로덕션 환경으로 배포하는 데 필요했던 많은 수의 작업을 제거한다.</p>
<p><img src="https://cdn.jsdelivr.net/gh/SongHayoung/image@master/uPic/image-20240405150317538.png" alt=""></p>
<p>CI/CD 프로세스는 코드를 빌드, 테스트 및 프로덕션에 배포한다. 이를 통해 소프트웨어 팀은 더 나은 품질의 소프트웨어를 더 빠르게 배포할 수 있다.</p>
<h2 id="Continuous-Integration-CI"><a href="#Continuous-Integration-CI" class="headerlink" title="Continuous Integration (CI)"></a>Continuous Integration (CI)</h2><p>CI가 등장하기 전에는 일반적으로 개발팀이 사일로 형태로 운영되어 개별 개발자가 오랜 기간 동안 각기 다른 기능을 독립적으로 작업했다. 결국 이들의 작업은 공유 코드베이스로 병합되어야 했고, 수백 개의 파일과 기여자 간에 병합 충돌 및 호환성 문제와 같은 복잡한 문제가 발생했다. 흔히 “merge hell”이라 불리는 이 딜레마는 기존 개발 방식에서 직면한 어려움을 대표했다.</p>
<h3 id="Avoid-“merge-hell”"><a href="#Avoid-“merge-hell”" class="headerlink" title="Avoid “merge hell”"></a>Avoid “merge hell”</h3><p>앨리스와 밥이라는 두 명의 개발자가 있는 시나리오를 생각해 보자. 앨리스는 코드를 작성하고 완전히 완성되지 않았더라도 문제를 일으키지 않는 기능적인 버전이 나오면 공유한다. 그녀는 코드를 중앙 레포지토리에 업로드한다. 밥도 동일한 접근 방식을 따르며 항상 최신 버전의 코드를 확보한 후 작업을 시작한다. 앨리스가 계속해서 코드를 업데이트하면 밥도 똑같이 한다. 밥이 변경을 하면 엘리스는 문제 없이 이를 작업에 반영한다. 항상 최신 코드를 기반으로 작업하기 때문에 서로 간섭할 가능성이 낮고 원할하게 협업할 수 있다. 충돌이 발생하더라도 두 사람이 최근에 변경한 사항으로 인해 발생하는 경우가 많으므로 함께 앉아 문제를 해결할 수 있었다.</p>
<p>하지만 많은 사람이 지속적으로 코드를 기여하다 보면 문제가 발생할 수 밖에 없다. 항상 원활하게 실행되는 것은 아니며 새로운 오류가 발생할 수 있다. 해결책은 무엇일까?</p>
<h3 id="Automation"><a href="#Automation" class="headerlink" title="Automation"></a>Automation</h3><p>해결책은 자동화다. 자동화는 코드를 지속적으로 모니터링하는 경계 감시자 역할을 한다. 변경 사항이 발생하면 즉시 실행에 들어가 코드를 가져와 빌드하고 테스트를 실행한다. 이 과정에서 문제가 발생하면 팀에 알림이 전송되어 모든 사람이 문제를 인지할 수 있도록 한다. 이런 안전망이 구축되면 CI는 현실이 된다. 그러면 CI란 정확히 뭘까?</p>
<h3 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h3><p>CI에는 빌드 자동화, 테스트 실행, 개별 개발자의 코드를 공유 리포지토리로 병합하는 작업이 포함된다. CI의 주요 목표는 소스 코드를 공유 리포지토리에 효율적으로 통합하는 것이다. 변경 사항이 버전 관리 시스템에 커밋되면 자동화된 빌드 및 테스트 케이스가 실행되어 코드의 기능화 유효성을 보장한다. 이런 프로세스는 소스 코드가 컴파일되는 방식과 실행 중 테스트 케이스가 어떻게 수행되는지 검증한다.</p>
<h3 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h3><p>CI 프로세스 자체를 관리하는 데 사용할 수 있는 도구도 많다. GitHub Actions와 Buildkite가 최신의 예이며  Jenkins, CircleCI, TravisCI와 같은 도구도 자주 사용된다. 이런 도구는 CI에서 빌드 및 테스트 작업을 관리한다.</p>
<p>테스트를 작성하고 실행하기 위한 수많은 테스트 도구가 존재한다. 이런 도구는 일반적으로 언어 및 에코시스템에 따라 다르다. 예를 들어 JS의 경우 Jest라는 유닛 테스트 프레임워크가 있고, Playwright, Cypress는 웹 애플리케이션을 위한 일반적인 통합 테스트 프레임워크다.</p>
<p>빌드 도구는 훨씬 더 다양하고 에코시스템에 따라 다르다. Gradle은 Java용 빌드 도구다. JS 빌드 에코시스템은 파편화되어 있고 추적하기 어렵다. Webpack이 표준이지만 많은 새로운 빌드 도구가 훨씬 빠르다고 주장하고 있지만 Webpack 만큼 확장적이지 않다.</p>
<h3 id="Benefits-of-continuous-integration"><a href="#Benefits-of-continuous-integration" class="headerlink" title="Benefits of continuous integration"></a>Benefits of continuous integration</h3><p><img src="https://cdn.jsdelivr.net/gh/SongHayoung/image@master/uPic/image-20240405164800052.png" alt=""></p>
<h2 id="Continuous-Deployment-CD"><a href="#Continuous-Deployment-CD" class="headerlink" title="Continuous Deployment (CD)"></a><strong>Continuous Deployment (CD)</strong></h2><p>CD는 CI/CD 파이프라인에서 CI 다음 단계다. CD는 자동화된 테스트 단계를 통과한 모든 코드 변경 사항을 프로덕션에 자동으로 배포하는 관행이다.</p>
<p>진정한 연속 배포는 어렵고 CI 만큼 널리 채택되지는 않지만, 아래 설명된 것처럼 비슷하지만 미묘한 차이가 있는 연속 배포가 더 일반적 관행이다.</p>
<h3 id="Continuous-delivery"><a href="#Continuous-delivery" class="headerlink" title="Continuous delivery"></a><strong>Continuous delivery</strong></h3><p>CD는 코드 변경 사항을 프로덕션 환경에 신속히 배포하는데 중점을 둔다. 그 근본은 고객 만족을 위해 “가치 있는 소프트웨어의 조기 및 지속적인 배포”를 강조하는 애자일에서 따온다.</p>
<p>지속적 배포의 목표는 중요한 코드 변경 사항을 프로덕션으로 효율적으로 전환하는 것이다. 초기 단계에는 빌드 프로세스를 통해 코드를 배포 가능한 소프트웨어로 변환하는 작업이 포함된다. 소프트웨어가 준비되면 다음 논리적 단계는 프로덕션에 직접 배포하는 것처럼 보일 수 있다. 하지만 실제로는 안정적인 소프트웨어만 프로덕션 환경에 배포할 수 있도록 엄격한 테스트가 필요하다.</p>
<p>일반적으로 조직은 “QA”, “성능” 또는 “스테이징”과 같은 여러 테스트 환경을 유지한다. 이런 환경은 소프트웨어가 프로덕션 환경에 도달하기 전에 소프트웨어의 유효성을 검사하는 체크포인트 역할을 한다. 소프트웨어는 각 환경에서 테스트를 거쳐 배포 준비가 완료되었는지 확인한다.</p>
<p>본질적으로 지속적 배포에서 프로덕션으로의 여정에는 프로덕션 환경에 배포하기 전에 다양한 테스트 환경을 통해 소프트웨어를 전환하는 과정이 포함된다.</p>
<p>지속적 배포의 핵심 측면은 코드가 항상 배포 가능한 상태로 유지되도록 하는 것이다. 배포 프로세스가 완료되면 코드는 원하는 환경에 배포할 준비가 된 것이다. 이 엔드 투 엔드 프로세스에는 소스 코드 빌드, 테스트 케이스 실행, WAR 또는 JAR 파일과 같은 아티팩트 생성, 특정 환경으로의 배포가 포함된다.</p>
<h3 id="Automatic-deployment"><a href="#Automatic-deployment" class="headerlink" title="Automatic deployment"></a><strong>Automatic deployment</strong></h3><p>CD는 코드 변경 사항을 프로덕션 환경에 자동으로 배포하는 것을 포함한다. 기본적으로 개발 파이프라인의 마지막 단계에 해당하는데, 이 단계에서는 아티팩트가 준비되고 테스트 케이스가 실행될 뿐만 아니라 프로세스가 프로덕션 환경에 아티팩트를 배포하는 단계까지 확장된다. 지속적 배포는 코드에 대한 모든 변경 사항이 사람의 개입 없이 프로덕션 환경에 즉시 배포되도록 보장한다.</p>
<h3 id="Continuous-deployment-vs-continuous-delivery"><a href="#Continuous-deployment-vs-continuous-delivery" class="headerlink" title="Continuous deployment vs. continuous delivery"></a><strong>Continuous deployment vs. continuous delivery</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/SongHayoung/image@master/uPic/image-20240405165350804.png" alt=""></p>
<p>CD는 일부 조직에 적합할 수 있지만, 소프트웨어 배포에 대한 신중하면서도 자동화된 접근 방식을 제공한다는 점에서 많은 조직이 노력하고 있는 접근 방식이다.</p>
<h3 id="Tools-1"><a href="#Tools-1" class="headerlink" title="Tools"></a><strong>Tools</strong></h3><p> GitHub Actions, Buildkite, Jenkins와 같은 도구는 일반적으로 CD 작업을 처리하는 데 사용된다. 인프라별 도구도 CD를 더 쉽게 유지 관리할 수 있게 해준다. 예를 들어, ArgoCD는 k8s에서 널리 사용된다.</p>
<p>CI/CD는 팀이 더 나은 품질의 소프트웨어를 더 빨리 출시할 수 있도록 도와주는 강력한 소프트웨어 개발 관행이다. 하지만 만능 솔루션은 아니며 시스템의 복잡성에 따라 구현 방식이 달라질 수 있다.</p>
<h3 id="Benefits-of-continuous-deployment"><a href="#Benefits-of-continuous-deployment" class="headerlink" title="Benefits of continuous deployment"></a><strong>Benefits of continuous deployment</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/SongHayoung/image@master/uPic/image-20240405165543830.png" alt=""></p>
<h2 id="Deployment-Strategies"><a href="#Deployment-Strategies" class="headerlink" title="Deployment Strategies"></a><strong>Deployment Strategies</strong></h2><h3 id="Big-bang-deployment"><a href="#Big-bang-deployment" class="headerlink" title="Big bang deployment"></a><strong>Big bang deployment</strong></h3><p>프로덕션에 변경 사항을 배포하는 가장 초기의 방법 중 하나는 빅뱅 배포다. 모든 변경 사항을 한꺼번에 적용하므로 새 시스템을 켜기 위해 기존 시스템을 종료해야 하는 약간의 다운 타임을 포함한다. 다운타임은 보통 짧지만 계획대로 진행되지 않을 경우 큰 문제가 발생할 수 있으므로 주의해야 한다. 준비와 테스트가 핵심이다. 문제가 발생하면 이전 버전으로 롤백한다. 하지만 롤백이 항상 문제가 없는 것은 아니다. 여전히 사용자에게 혼란을 줄 수 있고 데이터에 영향을 미칠 수 잇다. 따라서 탄탄한 롤백 계획이 필요하다.</p>
<p><img src="https://cdn.jsdelivr.net/gh/SongHayoung/image@master/uPic/image-20240405165725805.png" alt=""></p>
<p>예를 들어 복잡한 데이터베이스 업그레이드가 필요한 경우 빅뱅 배포가 유일한 선택인 경우가 있다.</p>
<h3 id="Rolling-deployment"><a href="#Rolling-deployment" class="headerlink" title="Rolling deployment"></a><strong>Rolling deployment</strong></h3><p>이 방법을 사용하면 시간이 지남에 따라 시스템의 여러 부분을 점진적으로 업데이트할 수 있다. 새 버전의 애플리케이션을 프로덕션 환경에 점진적으로 배포하는 단계적 롤아웃이다.</p>
<p><img src="https://cdn.jsdelivr.net/gh/SongHayoung/image@master/uPic/image-20240405165830642.png" alt=""></p>
<p>롤링 배포의 큰 장점 중 하나는 일반적으로 다운 타임을 방지할 수 있다는 점이다. 한 서버를 업데이트하는 동안 다른 서버는 계속 가동되어 사용자에게 서비스를 제공할 수 있다. 또 다른 장점은 롤 아웃 중에 문제를 조기에 발견하고 완화할 수 있어 문제가 광범위하게 확산될 위험을 줄일 수 있다는 점이다. 한번에 시스템의 일부만 새 버전에 노출된다.</p>
<p>그러나 롤링 배포는 일반적으로 더 느린 프로세스다. 시스템 전반의 문제 발생 위험을 줄이기는 하지만 완전히 제거하지는 못한다. 문제가 초기 점검을 놓친 경우에도 더 많은 서버를 업데이트 하면서 문제가 계속 확산될 수 있다.</p>
<p>또한 이 전략은 타겟팅된 롤아웃을 지원하지 않는다. 롤아웃 중에 새 버전을 받는 사용자를 제어할 수 없다. 서버를 업데이트 하면서 모든 사용자에게 점진적으로 새 버전이 표시되며 위치, 디바이스 유형 등의 기준에 따라 특정 사용자에게만 새 버전을 제공할 수는 없다.</p>
<h3 id="Blue-Green-deployment"><a href="#Blue-Green-deployment" class="headerlink" title="Blue-Green deployment"></a><strong>Blue-Green deployment</strong></h3><p>블루 그린 전략은 파란색과 초록색으로 명명된 두 개의 동일한 프로덕션 환경을 유지한다. 언제든 한 쪽은 활성화 되어 사용자에게 표시되고 다른 쪽은 유휴 상태다. 활성 환경(e.g blue)은 사용자에게 애플리케이션의 현재 라이브 버전을 제공한다. 유휴 환경(e.g green)은 새 버전을 안전하게 배포하고 테스트할 수 있는 플레이 그라운드다.</p>
<p>새 버전이 준비되면 녹생 환경에 배포한다. 이 작업이 진행되는 동안 파란색 환경에서는 여전히 현재 버전의 애플리케이션을 사용자에게 제공한다. 그런 다음 QA 팀이 녹색 환경에서 새 버전을 테스트한다. 이를 통해 사용자에게 도달하기 전에 버그나 문제를 발견하고 수정할 수 있는 기회를 제공한다. 녹색 환경의 새 버전이 준비되었다고 판단되면 로드 밸런서를 전환해 트래픽을 파란색 환경에서 녹색 환경으로 리디렉션 하기만 하면 된다. 사용자는 다운타임 없이 애플리케이션의 새 버전으로 원활하게 전환된다.</p>
<p>이제 파란색 환경은 유휴 상태가 되어 안전망 역할을 한다. 새 버전에 문제가 발생하면 신속하게 다시 전환해 이전 버전으로 효과적으로 롤백할 수 있다.</p>
<p><img src="https://cdn.jsdelivr.net/gh/SongHayoung/image@master/uPic/image-20240405170259874.png" alt=""></p>
<p>블루 그린 배포는 원활한 전환과 손쉬운 롤백이 가능하지만 단점이 있다. 롤링 배포와 마찬가지로 새 버전을 특정 사용자에게 지정할 수 없다. 파란색에서 녹색으로의 전환은 모든 사용자에게 한 번에 이루어 진다. 또한 리소스 집약적이다. 두 개의 동일한 프로덕션 환경을 유지 관리하면 인프라와 리소스 요구 사항이 두 배가 된다. 배포 사이에 유휴 환경을 스핀다운할 수 도 있지만 이 경우 복잡성이 증가한다. 두 개의 병렬 프로덕션 환경을 관리하고 원활한 데이터 동기화를 보장하는 것은 배포 프로세스에 상당한 복잡성을 더할 수 있다. 이를 위해서는 정교한 인프라와 툴링이 필요하다.</p>
<h3 id="Canary-deployment"><a href="#Canary-deployment" class="headerlink" title="Canary deployment"></a><strong>Canary deployment</strong></h3><p>카나리아 배포는 모든 서버나 사용자에게 새 버전을 배포하는 대신 작은 하위 집합인 카나리아 집합을 배포한다. 서버의 일부 또는 사용자 그룹과 같은 특정 기준으로 선택되는 경우가 많다. 이렇게 하면 실제 조건에서 새 버전의 성능을 훨씬 더 작은 규모로 모니터링할 수 있다. 모든 것이 순조롭게 진행되고 새 버전이 예상대로 작동하면 나머지 서버나 사용자들에게 점진적으로 배포할 수 있다. 또한 문제가 발생하면 안전망이 있다. 배포를 중단하고 문제를 해결한 후 다시 시도하면 대부분의 사용자 기반에 영향을 주지 않고도 배포를 진행할 수 있다. 이런 점진적 접근 방식은 안전성과 통제력을 모두 제공한다. 또한 카나리아 배포는 지리적 위치나 디바이스 유형과 같은 사용자별 기준에 따라 카나리아를 배포할 수 있는 타겟팅 롤아웃의 강력한 기능을 제공한다.</p>
<p>하지만 카나리아 배포에는 여러 어려움이 있다. 카나리아에 대한 신중한 모니터링과 자동화된 테스트가 필요하다. 필요에 따라 배포를 늘리거나 중단하려면 다소 복잡한 인프라 도구가 필요하다. 특히 데이터베이스 스키마 변경이나 API 호환성 문제를 처리할 때 이 전략을 구현하고 관리하기가 복잡할 수 있다. 카나리아 배포는 일반적으로 독립형 전략이 아니다. 카나리아 배포는 롤링 배포와 결합해 두 가지의 장점을 결합한 접근 방식을 만드는 경우가 많다.</p>
<p><img src="https://cdn.jsdelivr.net/gh/SongHayoung/image@master/uPic/image-20240405170804995.png" alt=""></p>
<h3 id="Feature-toggle"><a href="#Feature-toggle" class="headerlink" title="Feature toggle"></a><strong>Feature toggle</strong></h3><p>기능 토글은 앞서 설명한 전략들과 차별화 되는 전략이다. 전체 애플리케이션의 새 버전을 배포하는 것이 아니라 해당 애플리케이션 내에서 특정 새 기능을 관리하는 것이다. 기능 토글을 사용하면 코드에 새로운 기능에 대한 토글 또는 스위치를 도입한다. 이를 통해 특정 사용자나 상황에 따라 기능을 켜거나 끌 수 있다. </p>
<p><img src="https://cdn.jsdelivr.net/gh/SongHayoung/image@master/uPic/image-20240405170906358.png" alt=""></p>
<p>기능 토글은 앞서 설명한 배포 전략과 함께 사용할 수 있다. 예를 들어 카나리아 배포를 하는 경우 카나리아 사용자만 기능 토글을 켜서 나머지 사용자층은 현재 버전을 계속 사용하는 동안 새 기능을 테스트할 수 있다. 기능 토글은 새로운 기능에 대한 탁월한 제어 기능을 제공하며 타겟팅된 사용자가 테스트가 가능하다. 기능의 성능을 확인하기 위해 A/B 테스트를 하거나 기능을 점진적으로 출시할 때 유용하다.</p>
<p>하지만 기능 토글도 단점이 잇다. 토글을 제대로 관리하지 않으면 코드베이스에 복잡성을 더하고 테스트를 더 어렵게 만들 수 있다. 오래되거나 더 이상 사용되지 않는 토글은 정리해 토글 부채를 방지해야 시스템을 유지 관리하기가 점점 더 어려워질 수 있다.</p>
<h2 id="A-Typical-CI-CD-Pipeline"><a href="#A-Typical-CI-CD-Pipeline" class="headerlink" title="A Typical CI/CD Pipeline"></a><strong>A Typical CI/CD Pipeline</strong></h2><p>일반적인 CI/CD 파이프라인의 청사진을 살펴보자. </p>
<p><img src="https://cdn.jsdelivr.net/gh/SongHayoung/image@master/uPic/image-20240405171106949.png" alt=""></p>
<h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a><strong>Source</strong></h3><p>일반적인 CI/CD 파이프라인에서 가장 먼저 눈에 띄는 단계는 소스 코드 관리다. 여기에서는 애플리케이션의 모든 패키지와 종속성이 저장된다. 소스 제어 수준에서 한 가지 중요한 측면은 프로젝트 변경에 대해 일정 수준의 검토를 의무화하는 메커니즘이 필요하다는 것이다. 코드를 소스 제어에 임의로 병합해서는 안 되며, 풀 리퀘스트를 통해 지정된 검토자의 승인을 받아야 한다. 이는 다양한 기술을 사용해 설정할 수 있지만, 반드시 필요한 단계다. 최소한 한 명의 검토자가 필요하지만 이상적으로는 두 명 이상의 검토자를 두는것이 더 안전할 것이다.</p>
<h3 id="Build"><a href="#Build" class="headerlink" title="Build"></a><strong>Build</strong></h3><p>다음 단계는 빌드 프로세스다. 이 단계에서 코드는 package.json, pom 파일 또는 기타 언어별 구성 파일에 지정된 모든 종속성을 포함해 컴파일 과정을 거친다. 또한 프로젝트와 관련된 모든 단위 테스트를 실행해야 한다. 신뢰할 수 있는 CI/CD 파이프라인을 위해서는 광범위한 단위 테스트 범위가 필수적이다. 테스트를 통해 문제를 조기에 발견하고 애플리케이션이 예상대로 작동하는지 확인할 수 있다.</p>
<h4 id="Code-coverage"><a href="#Code-coverage" class="headerlink" title="Code coverage"></a><strong>Code coverage</strong></h4><p>TestNG, JUnit과 같은 많은 테스트 프레임워크는 특정 커밋에 대한 코드 커버리지를 계산한다. 보편적인 목표는 없지만 일반적으로 높은 코드 커버리지를 유지하는 것이 좋다. 코드베이스가 발전함에 따라 시간이 지남에 따라 이 비율을 꾸준히 높이는 것이 목표가 되어야 한다. 하지만 100% 커버리지 달성은 비현실 적인 경우가 많으며 강력한 CI/CD 파이프라인에 꼭 필요한 것은 아니다.</p>
<h3 id="Test-environment"><a href="#Test-environment" class="headerlink" title="Test environment"></a><strong>Test environment</strong></h3><p>다음 단계는 테스트 환경이다. 테스트 환경의 핵심은 통합 테스트를 실행하는 것이다. 통합 테스트는 API의 동작을 검증해 올바르게 작동하고 예상되는 비즈니스 규칙을 준수하는지 확인한다. 이런 테스트에는 API 상호 작용 및 비즈니스 로직 요구사항 충족과 같은 시나리오가 포함된다.</p>
<p>예를 들어, “주문 생성”과 같은 API의 경우 유효한 입력 데이터로 이 API를 호출하고 새 주문이 성공적으로 생성되었는지 확인하는 통합 테스트가 있어야 한다. 주문을 생성한 후 테스트는 주문 세부 정보를 검색하고 모든 주문 정보가 초기 입력과 일치하는지 확인해야 한다. 검색된 데이터가 전송된 데이터와 일치하지 않으면 테스트가 실패한 것이다.</p>
<p>또한 통합 테스트는 애플리케이션이 정의된 비즈니스 규칙을 준수하는지 검증한다. 예를 들어, 주문 금액이 10000$를 초과할 수 없다는 규칙이 있는 경우 이 시나리오에 대한 테스트가 필요하다. </p>
<p>이 테스트는 값이 $10000보다 큰 주문을 생성하려고 시도하고 애플리케이션이 비즈니스 규칙에 따라 이런 주문을 방지하거나 거부하는지 확인한다.</p>
<p>따라서 통합 테스트는 API의 핵심 기능을 검증해 예상한 대로 작동하는지 확인한다.</p>
<h4 id="Toggle-switch"><a href="#Toggle-switch" class="headerlink" title="Toggle switch"></a><strong>Toggle switch</strong></h4><p>특정 시점에 이런 단계를 활성화 또는 비활성화할 수 있어야 한다. 이 기능을 통해 배포 파이프라인의 다음 단계에 대한 변경사항 추진을 제어해 프로세스에 대한 유연성과 제어를 보장할 수 있다.</p>
<h4 id="Consider-dependencies"><a href="#Consider-dependencies" class="headerlink" title="Consider dependencies"></a><strong>Consider dependencies</strong></h4><p>또한 통합 테스트를 실행할 때는 종속성을 고려하는 것이 필수적이다. API가 고객 프로필 관리나 주소 저장과 같은 외부 서비스에 의존한다고 가정해 보자. 이 경우 시스템의 엔드 투 엔드 기능을 보장하기 위해 이런 종속성도 테스트해야 한다. 이런 포괄적인 테스트 접근 방식은 핵심 API와 애플리케이션의 기본 로직에 대해 확신을 심어주어 예상대로 작동하도록 보장한다.</p>
<p>전반적으로 테스트 환경은 샌드박스 역할을 해 배포 파이프라인을 더 진행하기 전에 변경 사항을 철저히 실험하고 검증할 수 있게 해준다.</p>
<h3 id="1-box-environment"><a href="#1-box-environment" class="headerlink" title="1-box environment"></a><strong>1-box environment</strong></h3><p>1-box 배포는 프로덕션 트래픽의 일부로 변경 사항을 먼저 테스트하는 방법이다. 이 방법은 모든 고객 트래픽이 이동하는 전체 프로덕션 환경에 잘못된 변경 사항을 배포할 위험을 완화하기 위한 것이다. 작동 방식은 다음과 같다. 프로덕션에 10개의 호스트가 있는 경우 하나의 호스트가 “1-box” 호스트로 지정된다. 이 1-box 호스트는 전체 프로덕션 트래픽의 약 10% 이하를 처리한다. 이 설정은 안전망을 제공한다. 오류 증가나 속도 저하와 같은 문제가 발생하면 1-box 호스트에만 영향을 미친다. 문제가 있는 변경 사항을 하나의 호스트에서만 롤백하면 모든 프로덕션에서 롤백하는 것보다 훨씬 간단하고 빠르게 롤백할 수 있다.</p>
<h4 id="Rollback-alarms"><a href="#Rollback-alarms" class="headerlink" title="Rollback alarms"></a><strong>Rollback alarms</strong></h4><p>테스트에서 프로덕션으로 배포할 때 오류율 증가, 응답속도 저하, 중요한 지표의 편차 등 여러 가지 문제가 발생할 수 있다. 이런 문제를 포착하려면 롤백 알람이 필요하다. 롤백 알람은 오류율, 지연 시간, 주요 비즈니스 지표 등을 지속적으로 모니터링한다. 이런 지표 중 하나라도 설정된 한계를 벗어나 잠재적인 문제를 나타내는 경우, 알람이 자동으로 이전 안정 버전으로 롤백을 트리거한다. 이 자동화된 롤백은 문제가 발생했을 때 신속하게 되돌릴 수 있도록 보장해 CI/CD 파이프라인의 복원력을 향상시킨다.</p>
<h4 id="Bake-period"><a href="#Bake-period" class="headerlink" title="Bake period"></a><strong>Bake period</strong></h4><p>배포 중에 롤백 알람이 트리거되지 않는다고 가정하면 다음 단계는 Bake period다. 이 기간동안전체 배포 전에 프로덕션 환경에서 변경 사항을 안정화할 수 있다. 즉시 나타나지 않을 수 있는 지연된 문제나 비정상적인 동작을 포착하기 위한 버퍼 역할을 한다. 이 기간이 순조롭게 지나면 더 진행하기 전에 변경 사항에 대한 큰 확신을 가질 수 잇다.</p>
<h3 id="Production-environment"><a href="#Production-environment" class="headerlink" title="Production environment"></a><strong>Production environment</strong></h3><p>이 시점까지 모든 것이 순조롭게 진행되면 본격적인 프로덕션 환경으로 전화할 준비가 된 것이다. 여기에도 롤백 알람과 같은 동일한 안전 장치가 구현된다. 이 단계를 완료하면 모든 것이 올바르게 작동한다는 확신을 가지고 프로덕션 환경으로 자신 있게 진행할 수 있다.</p>
<!-- flag of hidden posts --></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Song Hayoung</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://songhayoung.github.io/2024/04/05/System%20Design/ByteByteGo/private/a-crash-course-in-ci-cd/">https://songhayoung.github.io/2024/04/05/System%20Design/ByteByteGo/private/a-crash-course-in-ci-cd/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/System-Design/">System Design</a></div><nav id="pagination"></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '3604b61642355579f55e',
  clientSecret: 'f552120f18ac5aee3f6297e05e97d94c0a25cd4b',
  repo: 'SongHayoung.github.io',
  owner: 'SongHayoung',
  admin: 'SongHayoung',
  id: md5(decodeURI(location.pathname)),
  language: 'en'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(https://xxxx.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2025 By Song Hayoung</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">Learning how to walk slowly to not miss important things</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/algolia.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>