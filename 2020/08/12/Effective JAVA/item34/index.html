<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="[Effective Java] int 상수 대신 열거 타입을 사용하라"><meta name="keywords" content="JAVA"><meta name="author" content="Song Hayoung"><meta name="copyright" content="Song Hayoung"><title>[Effective Java] int 상수 대신 열거 타입을 사용하라 | SUMFIのBlog</title><link rel="shortcut icon" href="/songcon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-169368422-1', 'auto');
ga('send', 'pageview');</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"7LZ6OJ4D6C","apiKey":"9a84e13f74ea78c3fd54512c10139c56","indexName":"git blog","hits":{"per_page":10},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/rss2.xml" title="SUMFIのBlog" type="application/rss+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B0"><span class="toc-number">1.</span> <span class="toc-text">들어가며</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enum"><span class="toc-number">2.</span> <span class="toc-text">Enum</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://avatars3.githubusercontent.com/u/37806785?s=460&amp;u=8c68d685faf7c5280cfbd736a6b1730b55fb4203&amp;v=4"></div><div class="author-info__name text-center">Song Hayoung</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://www.instagram.com/hayoung0_0/">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">7182</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">191</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">64</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">VISITED</div><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">Seoul Korea</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">Jeju Korea</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">British Columbia Canada</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">Boracay Philippines</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">三重　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">大阪　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">名古屋　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">静岡　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">札幌　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">京都　日本</a><a class="author-info-links__name text-center" href="https://songhayoung.github.io/">Bangkok Thailand</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://xxxx.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">SUMFIのBlog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/about">About</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">[Effective Java] int 상수 대신 열거 타입을 사용하라</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-08-12</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/">Java</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/Effective-Java/">Effective Java</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">1.5k</span><span class="post-meta__separator">|</span><span>Reading time: 9 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><span id="more"></span>
<p>정수 열거 패턴(int enum pattern)에는 단점이 많다. 타입 안전을 보장할 방법이 없으며 포현력도 좋지 않다. 오렌지를 건네야 할 메서드에 사과를 보내고 동등 연산자(==)로 비교하더라도 컴파일러는 아무런 경고 메세지를 출력하지 않는다. 깨지기 쉬운 프로그램을 만드는 방법이며 정수 상수는 문자열로 출력하기도 리플렉션을 이용하면 되지만 방법이 까다롭다.</p>
<p>문자열 열거 패턴(string enum pattern)은 더 나쁘다. 상수의 의미를 출력할 수 있음은 좋지만, 문자열 상수의 이름 대신 문자열 값을 그대로 하드코딩 하는 방식이다. 하드코딩한 문자열에 오타가 있어도 컴파일러는 알 방도가 없으며 문자열 비교에 따른 성능 저하는 덤이다.</p>
<h2 id="Enum"><a href="#Enum" class="headerlink" title="Enum"></a>Enum</h2><p>자바의 enum은 C, C++의 enum보다 강력하다. enum의 바탕이 되는 아이디어는 단순하다. enum 자체는 하나의 <strong>클래스</strong>이며 상수 하나당 자신의 인스턴스를 하나씩 만들어 <strong>public static final</strong> 필드로 공개한다. enum은 밖에서 접근할 수 있는 생성자를 제공하지 않으므로 사실상 final이다. 따라서 클라이언트가 인스턴스들을 딱 하나만 생성할 수 있도록 통제할 수 있음이 보장된다. 즉, enum은 싱글톤이다.</p>
<p>enum은 컴파일타임 타입 안전성을 제공한다. 어느 enum 클래스를 매개변수로 받는 메소드를 선언했다면 건네 받은 참조는 <strong>null 아니면 enum 클래스 내의 인스턴스뿐</strong>이다. 다른 타입의 enum 클래스를 넘기면 컴파일 오류가 난다. 타입이 다른 enum 변수에 할당하려 하거나 다른 enum 타입끼리 동등 연산을 하기 때문이다.</p>
<p>enum 클래스 각각은 고유한 namespace가 있어서 이름이 같은 상수도 공존할 수 있다. 또한 enum에 새로운 상수를 추가하거나 순서를 바꾸어도 <strong>클라이언트 사이드를 다시 컴파일하지 않아도 된다.</strong> 공개되는 것이 오직 <strong>필드의 이름뿐</strong>이라 정수 열거 패턴과 달리 <strong>상수 값이 클라이언트로 컴파일되어 각인되지 않기 때문이다.</strong> 다음 코드는 동작할 것 같으나 컴파일이 불가능한 코드이다. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ProductEnum</span> &#123;</span><br><span class="line">    TV(TV.class),</span><br><span class="line">    REFRIGERATOR(Refrigerator.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class clazz;</span><br><span class="line"></span><br><span class="line">    ProductEnum(Class clazz) &#123;</span><br><span class="line">        <span class="built_in">this</span>.clazz = clazz;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Class <span class="title function_">getProductClass</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> clazz;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;Refrigerator&gt; <span class="title function_">getOverStorageFridge</span><span class="params">(<span class="type">int</span> storage)</span> <span class="keyword">throws</span> ProductNotFoundException &#123;</span><br><span class="line">    List&lt;Refrigerator&gt; result = getProducts(ProductEnum.REFRIGERATOR.getProductClass()).stream().filter(refrigerator -&gt; refrigerator.getStorage() &gt;= storage).collect(Collectors.toList());</span><br><span class="line">    isProductExists(result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>다음과 같이 바꾼다면 컴파일이 가능하며 정상 동작한다. 위의 코드가 불가능한 이유는 <strong>상수 값이 클라이언트로 컴파일되어 각인되지 않기 때문이다.</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Refrigerator&gt; <span class="title function_">getOverStorageFridge</span><span class="params">(<span class="type">int</span> storage)</span> <span class="keyword">throws</span> ProductNotFoundException &#123;</span><br><span class="line">    List&lt;Refrigerator&gt; result = getProducts(Refrigerator.class).stream().filter(refrigerator -&gt; refrigerator.getStorage() &gt;= storage).collect(Collectors.toList());</span><br><span class="line">    isProductExists(result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>또한 enum의 toString 메소드는 출력하기 적합한 문자열을 리턴한다. 이 뿐만 아니라 enum에는 임의의 메소드나 필드를 추가할 수 있고 임의의 인터페이스를 구현하게 할 수도 있다. 다음은 enum에 필드와 메소드를 추가한 간단한 코드이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Lotto</span> &#123;</span><br><span class="line">    FIRST(<span class="number">10000000</span>, <span class="string">&quot;1등&quot;</span>),</span><br><span class="line">    SECOND(<span class="number">5000000</span>, <span class="string">&quot;2등&quot;</span>),</span><br><span class="line">    THIRD(<span class="number">300000</span>, <span class="string">&quot;3등&quot;</span>),</span><br><span class="line">    FOURTH(<span class="number">20000</span>, <span class="string">&quot;4등&quot;</span>),</span><br><span class="line">    FIFTH(<span class="number">1000</span>, <span class="string">&quot;5등&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> reward;</span><br><span class="line">    <span class="keyword">private</span> String rank;</span><br><span class="line"></span><br><span class="line">    Lotto(<span class="type">int</span> reward, String rank) &#123;</span><br><span class="line">        <span class="built_in">this</span>.reward = reward;</span><br><span class="line">        <span class="built_in">this</span>.rank = rank;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getReward</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> reward;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getRank</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> rank;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>기능이 들어있는 enum 클래스를 만드는 일도 어렵지 않다. <strong>enum 상수 각각을 특정 데이터와 연결 지으려면 생성자에서 데이터를 받아 인스턴스 필드에 저장하면 된다.</strong> enum은 근본적으로 불변이라 모든 필드는 final이여야 한다. enum은 자신 안에 정의된 상수들의 값을 배열에 담아 리턴하는 정적 메소드인 values를 제공한다. 각 enum의 값의 toString은 상수 이름을 문자열로 반환한다. 마음에 들지 않는다면 오버라이딩을 통해 재정의도 가능하다.</p>
<p>그렇다면 enum의 상수 하나를 제거하면 어떻게 될까? 이는 제거한 상수를 참조하지 않는 클라이언트는 아무 영향이 없다. 참조하는 클라이언트라면 재 컴파일시에는 상수를 참조하는 코드라인에서, 재 컴파일을 하지 않았다면 런타임에 해당 코드라인에서 오류가 발생한다. 아주 바람직하다.</p>
<p>enum을 외부 클라이언트에 노출할 필요가 없다면 private나 package-private로 선언하면 된다.</p>
<p>종종 상황에 따라 enum의 상수마다 동작이 달리지는 코드가 필요해질 경우가 있다. 다음 코드를 보자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">TrafficLightColour</span> &#123; RED, GREEN, YELLOW &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">approachIntersection</span><span class="params">(TrafficLightColour state)</span> &#123;</span><br><span class="line">  <span class="type">boolean</span> stop;</span><br><span class="line">  <span class="keyword">switch</span> (state) &#123;</span><br><span class="line">    <span class="keyword">case</span> GREEN:</span><br><span class="line">      stop = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> YELLOW:</span><br><span class="line">    <span class="keyword">case</span> RED:</span><br><span class="line">      stop = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (stop) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위 코드는 동작은 하지만 깔끔하지 못하다. stop의 코드라인은 stop에 정상적인 값이 할당 되어야만 도달할 수 있을거 같지만 초기화 되지 않은 상태로도 도달이 가능하다. 위에 말한 컴파일 상황을 이용하는 것이다.</p>
<blockquote>
<p>The definition of control flow in JLS §14.21 does not consider whether enum switches handle all cases, so in the example above javac will complain that stop is not definitely assigned. This is because adding constants to an enum is a binary compatible change (see JLS §13.4.26), so the spec allows for the possibility that TrafficLightColour is defined in another library, and after compiling our code we update to a new version of the library (without recompiling) that adds another colour of traffic light (say, PURPLE) that the switch doesn’t handle.</p>
<p>This check should be used together with MissingCasesInEnumSwitch in environments where that kind of binary incompatibility is very unlikely. For example, if your build system accurately tracks changes to dependencies and you are deploying an application (instead of a library), the risk of skew between compile-time and runtime is minimal. One the other hand, if you are a library author and your code switches on an enum in a different library, you want want to include ‘defensive’ default cases to handle the situation where a user deploys your code together with an incompatible version of the other library.</p>
</blockquote>
<p>더 안좋은 점은 깨지기 쉬운 코드라는 점이다. 새로운 상수를 추가할 때 마다 case를 정의해주어야 한다. 다행히 enum은 상수별로 다르게 동작하는 코드를 더 나은 수단으로 제공한다. 또한 toString을 재정의하려거든 toString이 반환하는 문자열을 해당 enum 타입 상수로 변환해주는 메소드도 구현할 수 있다. 다음 코드를 보자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Operation</span> &#123;</span><br><span class="line">    PLUS(<span class="string">&quot;+&quot;</span>) &#123;<span class="keyword">public</span> <span class="type">double</span> <span class="title function_">apply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span> &#123;<span class="keyword">return</span> x + y;&#125;&#125;,</span><br><span class="line">    MINUS(<span class="string">&quot;-&quot;</span>) &#123;<span class="keyword">public</span> <span class="type">double</span> <span class="title function_">apply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span> &#123;<span class="keyword">return</span> x - y;&#125;&#125;,</span><br><span class="line">    TIMES(<span class="string">&quot;*&quot;</span>) &#123;<span class="keyword">public</span> <span class="type">double</span> <span class="title function_">apply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span> &#123;<span class="keyword">return</span> x * y;&#125;&#125;,</span><br><span class="line">    DIVIDE(<span class="string">&quot;.&quot;</span>) &#123;<span class="keyword">public</span> <span class="type">double</span> <span class="title function_">apply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span> &#123;<span class="keyword">return</span> x / y;&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String symbol;</span><br><span class="line"></span><br><span class="line">    Operation(String symbol) &#123; <span class="built_in">this</span>.symbol = symbol; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">double</span> <span class="title function_">apply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> symbol;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Operation&gt; stringToEnum = Stream.of(values()).collect(Collectors.toMap(Object::toString, e -&gt; e));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Optional&lt;Operation&gt; <span class="title function_">fromString</span><span class="params">(String symbol)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(stringToEnum.get(symbol));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Operation 상수가 stringToEnum 맵에 추가되는 시점은 enum 타입 상수 생성 후 정적 필드가 초기화 될 때다. 앞의 코드는 스트림을 이용했다. 자바 8 이전에는 빈 해시맵을 만들고 values가 반환한 배열을 순회하며 map에 값을 추가했을 것이다. 하지만 enum 타입 상수는 생성자에서 자신의 인스턴스를 맵에 추가할 수 없다. 이렇게 하려면 컴파일 오류가 나는데 만약 이 방식이 허용되었다면 런타임에 NullPointerException이 발생했을 것이다. enum 타입의 정적 필드 중 enum 타입의 생성자에서 접근할 수 있는 것은 상수 변수뿐이다. enum 타입 생성자가 실행되는 시점에는 정적 필드들이 아직 초기화되기 전이라 자기 자신을 추가하지 못하게 하는 제약이 꼭 필요하다. 이 제약의 특수한 예로 enum 타입 생성자에서 같은 enum 타입의 다른 상수에도 접근할 수 없다. fromString이 Optional<Operation>을 반환하는 점도 주의하자. 이는 주어진 문자열이 가리키는 연산이 존재하지 않을 수 있음을 클라이언트에 알리고 그 상황을 클라이언트에서 대처하도록 한 것이다.</p>
<p>하지만 상수별 메소드 구현에는 enum 타입 상수끼리 코드를 공유하기 어렵다는 단점이 있다. 다음 코드를 보자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">PayrollDay</span> &#123;</span><br><span class="line">    MONDAY,</span><br><span class="line">    TUESDAY,</span><br><span class="line">    WEDNESDAY,</span><br><span class="line">    THURSDAY,</span><br><span class="line">    FRIDAY,</span><br><span class="line">    SATURDAY,</span><br><span class="line">    SUNDAY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MINS_PER_SHIFT</span> <span class="operator">=</span> <span class="number">8</span> * <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> minutesWorked, <span class="type">int</span> payRate)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">basePay</span> <span class="operator">=</span> minutesWorked * payRate;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> overtimePay;</span><br><span class="line">        <span class="keyword">switch</span>(<span class="built_in">this</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> SATURDAY: <span class="keyword">case</span> SUNDAY:</span><br><span class="line">                overtimePay = basePay / <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                overtimePay = minutesWorked &lt;= MINS_PER_SHIFT ? <span class="number">0</span> : minutesWorked - MINS_PER_SHIFT) * payRate / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> basePay + overtimePay;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>간결하지만 이 또한 깨지기 쉬운 코드다. 다음 두 방법을 생각해보자. 첫번째는 상수별로 중복해서 잔업수당을 계산하는 코드를 넣는 방법이다. 두번째는 평일용과 주말용 계산 메소드를 helper 메소드로 작성한 다음 각 상수가 자신에게 필요한 메소드를 적절히 호출하면 된다. 두 방식 모두 가독성이 떨어진다. 또 switch문과 같은 단점이 발생한다. 가장 깔끔한 방법은 전략 패턴을 적용한 방법이다. 다음 코드를 보자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">PayrollDay</span> &#123;</span><br><span class="line">    MONDAY(WEEKDAY), TUESDAY(WEEKDAY), WEDNESDAY(WEEKDAY),</span><br><span class="line">    THURSDAY(WEEKDAY), FRIDAY(WEEKDAY),</span><br><span class="line">    SATURDAY(WEEKEND), SUNDAY(WEEKEND);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PayType payType;</span><br><span class="line"></span><br><span class="line">    PayrollDay(PayType payType) &#123; <span class="built_in">this</span>.payType = payType; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> minutesWorked, <span class="type">int</span> payRate)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> payType.pay(minutesWorked, payRate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">PayType</span> &#123;</span><br><span class="line">        WEEKDAY &#123;</span><br><span class="line">            <span class="type">int</span> <span class="title function_">overtimePay</span><span class="params">(<span class="type">int</span> minsWorked, <span class="type">int</span> payRate)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> minsWorked &lt;= MINS_PER_SHIFT ? <span class="number">0</span> :</span><br><span class="line">                        (minsWorked - MINS_PER_SHIFT) * payRate / <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        WEEKEND &#123;</span><br><span class="line">            <span class="type">int</span> <span class="title function_">overtimePay</span><span class="params">(<span class="type">int</span> minsWorked, <span class="type">int</span> payRate)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> minsWorked * payRate / <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">overtimePay</span><span class="params">(<span class="type">int</span> mins, <span class="type">int</span> payRate)</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MINS_PER_SHIFT</span> <span class="operator">=</span> <span class="number">8</span> * <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> minsWorked, <span class="type">int</span> payRate)</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">basePay</span> <span class="operator">=</span> minsWorked * payRate;</span><br><span class="line">            <span class="keyword">return</span> basePay + overtimePay(minsWorked, payRate);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (PayrollDay day : values())</span><br><span class="line">            System.out.printf(<span class="string">&quot;%-10s%d%n&quot;</span>, day, day.pay(<span class="number">8</span> * <span class="number">60</span>, <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>switch문이 반드시 부적합한것은 아니다. 기존 enum 타입에 상수별 동작을 혼합해 넣을 때는 switch문이 좋은 선택이 될 수도 있다. 예를 들어 서드파티에서 가져온 Operation enum 타입을 통해 각 연산의 반대 연산을 반환하는 메소드를 작성할 때는 적합할 수 있다. 혹은 추가하려는 메소드가 의미상 enum 타입에 속하지 않을때도 적합하다.</p>
<p>enum의 성능은 정수 상수와 크게 다르지 않다. 그럼 enum은 언제 써야할까? enum 타입은 <strong>필요한 원소를 컴파일 타임에 다 알 수 있는 상수 집합이라면 항상 enum 타입을 사용하자.</strong> 메뉴 아이템, 연산 코드, 플레그 등이 모두 여기 포함된다. 또한 <strong>enum 타입에 정의된 상수 개수가 영원히 고정 불변일 필요는 없다.</strong> 나중에 추가되도 바이너리 수준에서 호환이 가능하도록 설계되었기 때문이다.</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Song Hayoung</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://songhayoung.github.io/2020/08/12/Effective%20JAVA/item34/">https://songhayoung.github.io/2020/08/12/Effective%20JAVA/item34/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JAVA/">JAVA</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/08/12/Effective%20JAVA/item35/"><i class="fa fa-chevron-left">  </i><span>[Effective Java] ordinal 메소드 대신 인스턴스 필드를 사용하라</span></a></div><div class="next-post pull-right"><a href="/2020/08/12/Java/supertypetoken/"><span>[Java] Super Type Token</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '3604b61642355579f55e',
  clientSecret: 'f552120f18ac5aee3f6297e05e97d94c0a25cd4b',
  repo: 'SongHayoung.github.io',
  owner: 'SongHayoung',
  admin: 'SongHayoung',
  id: md5(decodeURI(location.pathname)),
  language: 'en'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(https://xxxx.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2023 By Song Hayoung</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">Learning how to walk slowly to not miss important things</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/algolia.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>